
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸šåŠ¡å‘˜æŠ¥ä»·åŠ©æ‰‹ (V2026.5 ä¿®å¤ç‰ˆ)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f2f4f8; font-family: 'Microsoft YaHei', sans-serif; }
    .header-bar { background: #2c3e50; color: #fff; padding: 15px 0; border-bottom: 4px solid #3498db; margin-bottom: 25px; }
    .card { border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-radius: 12px; }
    .card-header { background-color: #fff; font-weight: 700; border-bottom: 1px solid #eee; padding: 15px 20px; border-radius: 12px 12px 0 0 !important; }
    .price-main { font-size: 1.4rem; font-weight: 800; color: #e74c3c; }
    .warn-box { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 12px; border-radius: 6px; font-size: 0.85rem; margin-bottom: 15px; }
    .status-ok { color: #198754; font-weight: 700; }
    .status-err { color: #dc3545; font-weight: 700; }
    .table-sm td, .table-sm th { vertical-align: middle; }
    .compliance-box { background: #e9ecef; border-radius: 6px; padding: 10px; margin-top: 15px; font-size: 0.85rem; }
    .location-tag { font-size: 0.9rem; background: #e8f4fd; color: #0c5460; padding: 5px 10px; border-radius: 4px; display:block; margin-top:5px; border:1px solid #bee5eb;}
  </style>
</head>
<body>

<div class="header-bar">
  <div class="container d-flex justify-content-between align-items-center">
    <div><h4 class="m-0 fw-bold">ğŸ“¦ ä¸šåŠ¡å‘˜æŠ¥ä»·åŠ©æ‰‹</h4><div class="small opacity-75">V2026.5 | æ·±åº¦æ‰«è¡¨ä¿®æ­£ | é‚®ç¼–ä¸­è‹±æ–‡åŒæ˜¾</div></div>
    <div class="text-end d-none d-md-block"><span class="badge bg-info text-dark">T0-T3 å®æ—¶è®¡ç®—</span></div>
  </div>
</div>

<div class="container pb-5">
  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card h-100">
        <div class="card-header">1. åŸºç¡€ä¿¡æ¯</div>
        <div class="card-body">
          <form id="calcForm">
            <div class="mb-3">
              <label class="form-label small fw-bold text-muted">å‘è´§ä»“åº“</label>
              <select class="form-select" id="whSelect"></select>
              <div class="form-text small text-end text-primary" id="whRegion"></div>
            </div>

            <div class="mb-3">
              <label class="form-label small fw-bold text-muted">å®¢æˆ·ç­‰çº§</label>
              <div class="btn-group w-100" role="group">
                <input type="radio" class="btn-check" name="tier" id="t0" value="T0"><label class="btn btn-outline-dark" for="t0">T0</label>
                <input type="radio" class="btn-check" name="tier" id="t1" value="T1"><label class="btn btn-outline-dark" for="t1">T1</label>
                <input type="radio" class="btn-check" name="tier" id="t2" value="T2"><label class="btn btn-outline-dark" for="t2">T2</label>
                <input type="radio" class="btn-check" name="tier" id="t3" value="T3" checked><label class="btn btn-outline-dark" for="t3">T3</label>
              </div>
            </div>

            <div class="bg-light p-2 rounded border mb-3">
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <label class="form-label small fw-bold text-muted m-0">ç‡ƒæ²¹è´¹ç‡ (%)</label>
                    <span class="badge bg-secondary" style="font-size:0.65rem">MTç³»åˆ—ç”Ÿæ•ˆ</span>
                </div>
                <div class="input-group input-group-sm">
                    <input type="number" class="form-control fw-bold text-primary" id="fuelInput" value="16.0" step="0.01">
                    <span class="input-group-text">%</span>
                </div>
                <div class="form-text small text-muted" style="font-size:0.75rem">* è´¹ç‡å¯æ‰‹åŠ¨ä¿®æ”¹ã€‚FedEx-632/è¶…å¤§ä»¶è‡ªåŠ¨åº”ç”¨85æŠ˜ã€‚</div>
            </div>

            <div class="row g-2 mb-3">
              <div class="col-6">
                <label class="form-label small fw-bold text-muted">é‚®ç¼– (Zip)</label>
                <input type="text" class="form-control" id="zipCode" placeholder="5ä½æ•°å­—">
              </div>
              <div class="col-6">
                <label class="form-label small fw-bold text-muted">åœ°å€ç±»å‹</label>
                <select class="form-select" id="addrType">
                  <option value="res">ğŸ  ä½å®…</option>
                  <option value="com">ğŸ¢ å•†ä¸š</option>
                </select>
              </div>
              <div class="col-12" id="locDisplay"></div>
            </div>

            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" id="sigToggle">
              <label class="form-check-label small fw-bold" for="sigToggle">ç­¾åæœåŠ¡ (Signature)</label>
            </div>

            <div class="bg-light p-3 rounded border">
              <label class="form-label small fw-bold text-muted mb-2">åŒ…è£¹è§„æ ¼ (Inch / Lb)</label>
              <div class="row g-2 mb-2">
                <div class="col-4"><input type="number" class="form-control form-control-sm" id="dimL" placeholder="é•¿ L"></div>
                <div class="col-4"><input type="number" class="form-control form-control-sm" id="dimW" placeholder="å®½ W"></div>
                <div class="col-4"><input type="number" class="form-control form-control-sm" id="dimH" placeholder="é«˜ H"></div>
              </div>
              <div class="input-group input-group-sm">
                <span class="input-group-text">å®é‡</span>
                <input type="number" class="form-control" id="weight" placeholder="LBS">
              </div>
            </div>

            <div class="compliance-box" id="complianceBox" style="display:none;">
              <div class="fw-bold mb-1 text-danger">âš ï¸ è§„æ ¼é¢„æ£€ (Compliance)</div>
              <ul class="mb-0 ps-3" id="complianceList"></ul>
            </div>

            <button type="button" class="btn btn-primary w-100 mt-4 fw-bold py-2" id="btnCalc">è®¡ç®—æŠ¥ä»· (Calculate)</button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>ğŸ“Š æµ‹ç®—ç»“æœ</span>
          <span class="badge bg-warning text-dark" id="resTierBadge">T3</span>
        </div>
        <div class="card-body">
          <div class="warn-box">
            <strong>ğŸ“¢ ç³»ç»Ÿå…¬å‘Šï¼š</strong><br>
            1. <b>æ•°æ®æ¥æº</b>ï¼šæŠ¥ä»·ç›´æ¥è¯»å–è‡ª 2026 æœ€æ–°æ–‡æ¡£ (T0-T3)ã€‚<br>
            2. <b>ç‡ƒæ²¹é€»è¾‘</b>ï¼šFedEx-632 / è¶…å¤§åŒ…è£¹ ç‡ƒæ²¹è´¹ <b>85æŠ˜</b>ï¼›å…¶ä»–MTæ¸ é“å…¨é¢æ”¶å–ã€‚<br>
            3. <b>åˆ†åŒºé€»è¾‘</b>ï¼šGOFOä½¿ç”¨è‡ªè¥åˆ†åŒºè¡¨ï¼›FedExç³»åˆ—ä½¿ç”¨æ ‡å‡†åˆ†åŒºã€‚<br>
            4. <b>æ˜¾ç¤ºé€»è¾‘</b>ï¼šæ ¹æ®æ‰€é€‰ä»“åº“ï¼Œè‡ªåŠ¨éšè—ä¸æ”¯æŒçš„æ¸ é“ã€‚<br>
            5. <b>æ— æŠ¥ä»·ï¼Ÿ</b>ï¼šè¯·æ£€æŸ¥é‡é‡æ˜¯å¦è¶…å‡ºæ¸ é“é™åˆ¶ï¼ˆå¦‚ UniUni é™é‡ 20lbï¼‰ã€‚
          </div>

          <div class="alert alert-info py-2 small" id="pkgInfo">è¯·åœ¨å·¦ä¾§å½•å…¥æ•°æ®...</div>

          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light small text-secondary">
                <tr>
                  <th width="20%">æ¸ é“</th>
                  <th width="8%">Zone</th>
                  <th width="10%">è®¡è´¹é‡</th>
                  <th width="12%">åŸºç¡€è¿è´¹</th>
                  <th width="25%">é™„åŠ è´¹æ˜ç»†</th>
                  <th width="15%" class="text-end">æ€»è´¹ç”¨</th>
                  <th width="10%" class="text-center">çŠ¶æ€</th>
                </tr>
              </thead>
              <tbody id="resBody">
                <tr><td colspan="7" class="text-center py-4 text-muted">æš‚æ— ç»“æœ</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="text-center py-4 text-muted small">
  &copy; 2026 SureGo Logistics | Data Generated: <span id="updateTime"></span>
</footer>

<script>
  const DATA = {"warehouses": {"60632": {"name": "SureGoç¾ä¸­èŠåŠ å“¥-60632ä»“", "region": "CENTRAL"}, "91730": {"name": "SureGoç¾è¥¿åº“å¡è’™æ ¼-91730æ–°ä»“", "region": "WEST"}, "91752": {"name": "SureGoç¾è¥¿ç±³æ‹‰ç½—é©¬-91752ä»“", "region": "WEST"}, "08691": {"name": "SureGoç¾ä¸œæ–°æ³½è¥¿-08691ä»“", "region": "EAST"}, "06801": {"name": "SureGoç¾ä¸œè´å¡å°”-06801ä»“", "region": "EAST"}, "11791": {"name": "SureGoç¾ä¸œé•¿å²›-11791ä»“", "region": "EAST"}, "07032": {"name": "SureGoç¾ä¸œæ–°æ³½è¥¿-07032ä»“", "region": "EAST"}, "63461": {"name": "SureGoé€€è´§æ£€æµ‹-ç¾ä¸­å¯†è‹é‡Œ63461é€€è´§ä»“", "region": "CENTRAL"}}, "channels": {"GOFO-æŠ¥ä»·": {"keywords": ["GOFO", "æŠ¥ä»·"], "exclude": ["MT", "UNIUNI", "å¤§ä»¶"], "allow_wh": ["91730", "60632"], "fuel_calc": "none", "fuel_discount": false, "fees": {"res": 0, "sig": 0}}, "GOFO-MT-æŠ¥ä»·": {"keywords": ["GOFO", "UNIUNI", "MT"], "sheet_col_offset": "left", "allow_wh": ["91730", "60632"], "fuel_calc": "manual", "fuel_discount": false, "fees": {"res": 0, "sig": 0}}, "UNIUNI-MT-æŠ¥ä»·": {"keywords": ["GOFO", "UNIUNI", "MT"], "sheet_col_offset": "right", "allow_wh": ["91730", "60632"], "fuel_calc": "none", "fuel_discount": false, "fees": {"res": 0, "sig": 0}}, "USPS-YSD-æŠ¥ä»·": {"keywords": ["USPS", "YSD"], "allow_wh": ["91730", "91752", "60632"], "fuel_calc": "none", "fuel_discount": false, "fees": {"res": 0, "sig": 0}, "no_peak": true}, "FedEx-632-MT-æŠ¥ä»·": {"keywords": ["632"], "allow_wh": ["91730", "91752", "60632", "08691", "06801", "11791", "07032"], "fuel_calc": "manual", "fuel_discount": true, "fees": {"res": 2.61, "sig": 4.37}}, "FedEx-MT-è¶…å¤§åŒ…è£¹-æŠ¥ä»·": {"keywords": ["è¶…å¤§åŒ…è£¹"], "allow_wh": ["91730", "91752", "60632", "08691", "06801", "11791", "07032"], "fuel_calc": "manual", "fuel_discount": true, "fees": {"res": 2.61, "sig": 4.37}}, "FedEx-ECO-MTæŠ¥ä»·": {"keywords": ["ECO", "MT"], "allow_wh": ["91730", "91752", "60632", "08691", "06801", "11791", "07032"], "fuel_calc": "manual", "fuel_discount": false, "fees": {"res": 0, "sig": 0}}, "FedEx-MT-å±é™©å“-æŠ¥ä»·": {"keywords": ["å±é™©å“"], "allow_wh": ["60632", "08691", "06801", "11791", "07032"], "fuel_calc": "manual", "fuel_discount": false, "fees": {"res": 3.32, "sig": 9.71}}, "GOFOå¤§ä»¶-MT-æŠ¥ä»·": {"keywords": ["GOFOå¤§ä»¶", "MT"], "allow_wh": ["91730", "91752", "08691", "06801", "11791", "07032"], "fuel_calc": "manual", "fuel_discount": false, "fees": {"res": 2.93, "sig": 0}}, "XLmiles-æŠ¥ä»·": {"keywords": ["XLmiles"], "allow_wh": ["91730"], "fuel_calc": "none", "fuel_discount": false, "fees": {"res": 0, "sig": 10.2}}}, "zip_db": {}, "us_states_cn": {"AL": "é˜¿æ‹‰å·´é©¬", "AK": "é˜¿æ‹‰æ–¯åŠ ", "AZ": "äºšåˆ©æ¡‘é‚£", "AR": "é˜¿è‚¯è‰²", "CA": "åŠ åˆ©ç¦å°¼äºš", "CO": "ç§‘ç½—æ‹‰å¤š", "CT": "åº·æ¶…ç‹„æ ¼", "DE": "ç‰¹æ‹‰å", "FL": "ä½›ç½—é‡Œè¾¾", "GA": "ä½æ²»äºš", "HI": "å¤å¨å¤·", "ID": "çˆ±è¾¾è·", "IL": "ä¼Šåˆ©è¯ºä¼Š", "IN": "å°ç¬¬å®‰çº³", "IA": "çˆ±è·å", "KS": "å ªè¨æ–¯", "KY": "è‚¯å¡”åŸº", "LA": "è·¯æ˜“æ–¯å®‰é‚£", "ME": "ç¼…å› ", "MD": "é©¬é‡Œå…°", "MA": "é©¬è¨è¯¸å¡", "MI": "å¯†æ­‡æ ¹", "MN": "æ˜å°¼è‹è¾¾", "MS": "å¯†è¥¿è¥¿æ¯”", "MO": "å¯†è‹é‡Œ", "MT": "è’™å¤§æ‹¿", "NE": "å†…å¸ƒæ‹‰æ–¯åŠ ", "NV": "å†…åè¾¾", "NH": "æ–°ç½•å¸ƒä»€å°”", "NJ": "æ–°æ³½è¥¿", "NM": "æ–°å¢¨è¥¿å“¥", "NY": "çº½çº¦", "NC": "åŒ—å¡ç½—æ¥çº³", "ND": "åŒ—è¾¾ç§‘ä»–", "OH": "ä¿„äº¥ä¿„", "OK": "ä¿„å…‹æ‹‰è·é©¬", "OR": "ä¿„å‹’å†ˆ", "PA": "å®¾å¤•æ³•å°¼äºš", "RI": "ç½—å¾·å²›", "SC": "å—å¡ç½—æ¥çº³", "SD": "å—è¾¾ç§‘ä»–", "TN": "ç”°çº³è¥¿", "TX": "å¾·å…‹è¨æ–¯", "UT": "çŠ¹ä»–", "VT": "ä½›è’™ç‰¹", "VA": "å¼—å‰å°¼äºš", "WA": "åç››é¡¿", "WV": "è¥¿å¼—å‰å°¼äºš", "WI": "å¨æ–¯åº·æ˜Ÿ", "WY": "æ€€ä¿„æ˜", "DC": "åç››é¡¿ç‰¹åŒº"}, "tiers": {"T0": {}, "T1": {}, "T2": {}, "T3": {}}};
  document.getElementById('updateTime').innerText = new Date().toLocaleDateString();

  // --- 1. é‚®ç¼–åœ°åŒºä¸­è‹±æ–‡æ˜¾ç¤º ---
  document.getElementById('zipCode').addEventListener('blur', function() {
    let zip = this.value.trim();
    let display = document.getElementById('locDisplay');
    display.innerHTML = '';
    
    if(zip.length === 5 && DATA.zip_db && DATA.zip_db[zip]) {
        let info = DATA.zip_db[zip];
        let cnState = DATA.us_states_cn[info.state] || '';
        display.innerHTML = `<div class="location-tag">ğŸ“ ${info.city}, ${info.state} <span class="fw-bold">(${cnState})</span></div>`;
    }
  });

  // --- 2. è‡ªåŠ¨å¡«å…¥æŠ“å–çš„ç‡ƒæ²¹è´¹ ---
  (function initFuel() {
    let maxFuel = 0;
    Object.values(DATA.tiers).forEach(t => {
        Object.values(t).forEach(ch => {
            if(ch.fuel_rate && ch.fuel_rate > maxFuel) maxFuel = ch.fuel_rate;
        });
    });
    if(maxFuel > 0) {
        document.getElementById('fuelInput').value = (maxFuel * 100).toFixed(2);
    }
  })();

  // --- 3. è§„æ ¼æ ¡éªŒ ---
  function getXLService(L, W, H, Wt) {
    let dims = [L, W, H].sort((a,b)=>b-a);
    let maxL = dims[0];
    let girth = maxL + 2*(dims[1] + dims[2]);
    if (maxL <= 96 && girth <= 130 && Wt <= 150) return { code: "AH", name: "AHå¤§ä»¶" };
    if (maxL <= 108 && girth <= 165 && Wt <= 150) return { code: "OS", name: "OSå¤§ä»¶" };
    if (maxL <= 144 && girth <= 225 && Wt <= 200) return { code: "OM", name: "OMè¶…é™" };
    return { code: null, name: "è¶…XLè§„æ ¼" };
  }

  function checkCompliance(pkg) {
    let dims = [pkg.L, pkg.W, pkg.H].sort((a,b)=>b-a);
    let L = dims[0], W = dims[1], H = dims[2];
    let G = L + 2*(W+H);
    let msgs = [];
    
    if (pkg.Wt > 150) msgs.push("è¶…è¿‡150lb (é™¤XLmileså¤–ä¸å¯å‘)");
    if (L > 108) msgs.push("é•¿>108in (FedExè¶…é•¿)");
    
    let status = {
      uniuni: (pkg.Wt > 20 || L>20) ? "NO (é™é‡20lb/é™é•¿20in)" : "OK",
      usps: (pkg.Wt > 70 || G > 130) ? "NO (é™é‡70lb/å›´é•¿130in)" : "OK",
      xl: (pkg.Wt > 200 || L > 144 || G > 225) ? "NO (è¶…OMè§„æ ¼)" : "OK"
    };
    return { msgs, status };
  }

  function updateComplianceUI() {
    let L = parseFloat(document.getElementById('dimL').value)||0;
    let W = parseFloat(document.getElementById('dimW').value)||0;
    let H = parseFloat(document.getElementById('dimH').value)||0;
    let Wt = parseFloat(document.getElementById('weight').value)||0;
    
    if(L>0 && Wt>0) {
      let res = checkCompliance({L,W,H,Wt});
      let html = "";
      if(res.msgs.length > 0) html += `<li class="fw-bold">${res.msgs.join(', ')}</li>`;
      html += `<li>UniUni: ${res.status.uniuni}</li>`;
      html += `<li>USPS: ${res.status.usps}</li>`;
      html += `<li>XLmiles: ${res.status.xl}</li>`;
      
      document.getElementById('complianceList').innerHTML = html;
      document.getElementById('complianceBox').style.display = 'block';
    } else {
      document.getElementById('complianceBox').style.display = 'none';
    }
  }
  ['dimL','dimW','dimH','weight'].forEach(id => document.getElementById(id).addEventListener('input', updateComplianceUI));

  // --- 4. åˆå§‹åŒ– ---
  const whSelect = document.getElementById('whSelect');
  Object.keys(DATA.warehouses).forEach(code => {
    let opt = document.createElement('option');
    opt.value = code;
    opt.text = DATA.warehouses[code].name;
    whSelect.appendChild(opt);
  });
  
  // åˆ‡æ¢ä»“åº“æ—¶æ¸…ç©ºç»“æœï¼Œé¿å…è¯¯å¯¼
  whSelect.addEventListener('change', () => {
    document.getElementById('whRegion').innerText = `åŒºåŸŸ: ${DATA.warehouses[whSelect.value].region}`;
    document.getElementById('resBody').innerHTML = '<tr><td colspan="7" class="text-center py-4 text-muted">ä»“åº“å·²åˆ‡æ¢ï¼Œè¯·é‡æ–°ç‚¹å‡»è®¡ç®—</td></tr>';
  });
  if(whSelect.options.length > 0) whSelect.dispatchEvent(new Event('change'));

  // --- 5. Zone è®¡ç®— ---
  function calcZone(destZip, originZip, chName) {
    if(!destZip || destZip.length < 3) return 8;
    
    // ä¼˜å…ˆä½¿ç”¨é‚®ç¼–åº“ä¸­çš„ Zone (é’ˆå¯¹ GOFO)
    if(chName.includes("GOFO") && DATA.zip_db && DATA.zip_db[destZip]) {
        // è¿™é‡Œå‡è®¾ zip_db é‡Œå­˜äº† zone ä¿¡æ¯ï¼Œç›®å‰æˆ‘ä»¬å­˜çš„æ˜¯ city/state
        // ç”±äºæ²¡æœ‰å®Œæ•´åˆ†åŒºè¡¨ï¼Œè¿™é‡Œä½¿ç”¨é€šç”¨é€»è¾‘ï¼Œæˆ–è€…æ‚¨å¯ä»¥è¡¥å……åˆ†åŒºè¡¨é€»è¾‘
    }

    let d = parseInt(destZip.substring(0,3));
    let region = DATA.warehouses[originZip].region;

    if(region === 'WEST') {
      if(d >= 900 && d <= 935) return 2;
      if(d >= 936 && d <= 994) return 4;
      return 8;
    }
    if(region === 'EAST') {
      if(d >= 70 && d <= 89) return 2;
      if(d >= 100 && d <= 199) return 4;
      return 8;
    }
    if(region === 'CENTRAL') {
       if(d >= 600 && d <= 629) return 2;
       return 6;
    }
    return 8;
  }

  // --- 6. è®¡ç®—ä¸»é€»è¾‘ ---
  document.getElementById('btnCalc').onclick = () => {
    const whCode = whSelect.value;
    const tier = document.querySelector('input[name="tier"]:checked').value;
    const fuelRateInput = parseFloat(document.getElementById('fuelInput').value) || 0;
    const zip = document.getElementById('zipCode').value.trim();
    const isRes = document.getElementById('addrType').value === 'res';
    const sigOn = document.getElementById('sigToggle').checked;
    
    const pkg = {
      L: parseFloat(document.getElementById('dimL').value)||0,
      W: parseFloat(document.getElementById('dimW').value)||0,
      H: parseFloat(document.getElementById('dimH').value)||0,
      Wt: parseFloat(document.getElementById('weight').value)||0
    };

    document.getElementById('resTierBadge').innerText = tier;
    let dimWt = (pkg.L * pkg.W * pkg.H) / 222;
    document.getElementById('pkgInfo').innerHTML = 
      `<b>Pkg:</b> ${pkg.L}x${pkg.W}x${pkg.H}" | å®é‡:${pkg.Wt} | ä½“ç§¯é‡:${dimWt.toFixed(2)}`;

    const tbody = document.getElementById('resBody');
    tbody.innerHTML = '';

    // é¢„æ£€
    let comp = checkCompliance(pkg);

    Object.keys(DATA.channels).forEach(chName => {
      const conf = DATA.channels[chName];
      
      // A. ä»“åº“è¿‡æ»¤ (ä¸¥æ ¼)
      if(!conf.allow_wh.includes(whCode)) return;

      // B. æ¸ é“ç¡¬æ€§é˜»æ–­
      if(chName.includes("UNIUNI") && comp.status.uniuni.startsWith("NO")) return;
      if(chName.includes("USPS") && comp.status.usps.startsWith("NO")) return;
      if(chName.includes("XLmiles") && comp.status.xl.startsWith("NO")) return;
      if(chName.includes("FedEx") && !chName.includes("è¶…å¤§") && (pkg.Wt > 150 || pkg.L > 108)) return;

      // C. è®¡è´¹é‡
      let finalWt = Math.max(pkg.Wt, dimWt);
      if(!chName.includes("XLmiles")) finalWt = Math.ceil(finalWt);

      let zone = calcZone(zip, whCode, chName);
      let svcTag = "";

      if (chName.includes("XLmiles")) {
        let xl = getXLService(pkg.L, pkg.W, pkg.H, pkg.Wt);
        svcTag = `<br><small class="text-primary">${xl.name}</small>`;
      }

      // D. æŸ¥åŸºç¡€è¿è´¹
      let priceTable = (DATA.tiers[tier][chName] || {}).prices || [];
      // æŸ¥æ‰¾é€»è¾‘ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ª "é‡é‡ >= è®¡è´¹é‡" çš„è¡Œ
      let row = priceTable.find(r => r.w >= finalWt - 0.001);
      
      if(!row) {
         // æ— æŠ¥ä»· (å¯èƒ½æ˜¯å¤ªè½»æˆ–å¤ªé‡)
         return; 
      }

      let basePrice = row[zone] || row[8] || 0;
      if(basePrice <= 0) return;

      // E. é™„åŠ è´¹
      let surcharges = 0;
      let details = [];

      if(isRes && conf.fees.res > 0) {
        surcharges += conf.fees.res;
        details.push(`ä½å®… $${conf.fees.res}`);
      }
      if(sigOn && conf.fees.sig > 0) {
        surcharges += conf.fees.sig;
        details.push(`ç­¾å $${conf.fees.sig}`);
      }

      // F. ç‡ƒæ²¹è´¹ (ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥å€¼ + 85æŠ˜é€»è¾‘)
      if(conf.fuel_calc !== 'none') {
        let rate = fuelRateInput / 100;
        let tag = "";
        
        if (conf.fuel_discount) {
            rate = rate * 0.85; // 85æŠ˜
            tag = " (85æŠ˜)";
        }
        
        let fuelAmt = (basePrice + surcharges) * rate;
        surcharges += fuelAmt;
        details.push(`ç‡ƒæ²¹${tag} ${(rate*100).toFixed(2)}%: $${fuelAmt.toFixed(2)}`);
      }

      let total = basePrice + surcharges;

      tbody.innerHTML += `
        <tr>
          <td class="fw-bold text-start">${chName} ${svcTag}</td>
          <td><span class="badge bg-light text-dark border">Z${zone}</span></td>
          <td>${finalWt}</td>
          <td>$${basePrice.toFixed(2)}</td>
          <td class="small text-muted" style="line-height:1.2">${details.join('<br>') || '-'}</td>
          <td class="text-end price-main">$${total.toFixed(2)}</td>
          <td class="text-center"><span class="status-ok">âœ”</span></td>
        </tr>
      `;
    });
    
    if(tbody.innerHTML === '') {
        tbody.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-danger">æ— å¯ç”¨æŠ¥ä»· (è¯·æ£€æŸ¥è§„æ ¼æ˜¯å¦è¶…æ ‡ï¼Œæˆ–è¯¥ä»“åº“ä¸æ”¯æŒ)</td></tr>`;
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
